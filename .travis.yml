sudo: required

env:
  - BUILD_IMAGE_NAME=build-env:latest
  - BUILD_IMAGE_URI=docker.pkg.github.com/Questomatic/questomatic/$BUILD_IMAGE_NAME

services:
  - docker

before_install:
  - docker login docker.pkg.github.com -u "$DOCKER_USERNAME" -p "$DOCKER_PASSWORD"

script:
  - set -e
  - if [[ $TRAVIS_COMMIT_MESSAGE == *"trigger build-env"* ]]; then ./scripts/build-docker.sh $BUILD_IMAGE_NAME ; fi ;
  - if [[ "$TRAVIS_BRANCH" == "master" && "$TRAVIS_PULL_REQUEST" == "false" ]]; then
      docker login -u "$DOCKER_USERNAME" -p "$DOCKER_PASSWORD"
      docker push $BUILD_IMAGE_URI
    fi